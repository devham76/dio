<?php include("./header.html") ?>

<body class="bg-light wrap">
    <div class="container">
        <div class="py-4 text-center">
            <h2>참석여부 제출</h2>
            <p class="lead">
                원활한 행사 준비를 위해 꼭 참석여부를 꼭 남겨주세요 :)<br>
                참석여부는 중복으로 제출하실 수 있으며<br> 마지막 제출 결과를 최종 참석여부로 확인합니다
            </p>
        </div>

        <div class="order-md-1">
            <form class="needs-validation" name="submit_form">
                <div class="mb-3">
                    <label for="name"><span class="text-import">*</span>이름</label>
                    <input type="text" class="form-control" id="name" name="name" placeholder="김펭수">
                    <div class="invalid-feedback">
                        참석하시는 분의 이름을 입력해주세요
                    </div>
                </div>
                <div class="mb-3">
                    <label for="grade"><span class="text-import">*</span>학번</label>
                    <select class="custom-select d-block w-100" id="grade" name="grade" required>
                        <?
                            for ($grade=1995; $grade<2021; $grade++) {
                                $view_grade = substr($grade, -2, 2);
                                echo "<option value=" . $grade . ">" . $view_grade . "학번 </option>";
                            }
                        ?>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="attend"><span class="text-import">*</span>행사 참석여부</label>
                    <div class="custom-control custom-radio">
                        <input value="1" id="attend_1" name="attend" type="radio" class="custom-control-input" checked
                            required>
                        <label class="custom-control-label" for="attend_1">참석</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input value="2" id="attend_2" name="attend" type="radio" class="custom-control-input" required>
                        <label class="custom-control-label" for="attend_2">불참석</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input value="3" id="attend_3" name="attend" type="radio" class="custom-control-input" required>
                        <label class="custom-control-label" for="attend_3">미정</label>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="after_attend"><span class="text-import">*</span>뒷풀이 참석여부</label>
                    <div class="custom-control custom-radio">
                        <input value="1" id="after_attend_1" name="after_attend" type="radio" class="custom-control-input" checked
                            required>
                        <label class="custom-control-label" for="after_attend_1">참석</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input value="2" id="after_attend_2" name="after_attend" type="radio" class="custom-control-input" required>
                        <label class="custom-control-label" for="after_attend_2">불참석</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input value="3" id="after_attend_3" name="after_attend" type="radio" class="custom-control-input" required>
                        <label class="custom-control-label" for="after_attend_3">미정</label>
                    </div>
                </div>
                <div class="mb-3">
                        <label for="extraPeople">함께 오시는 인원</label>
                        <input type="number" class="form-control" id="extraPeoples" name="extraPeople" placeholder="0">
                </div>
                <div class="mb-3">
                        <label for="message">동문들에게 한마디</label>
                        <textarea rows="2" class="form-control" id="message" name="message" placeholder="댄싱머신 DIO 동문들 보고싶어요"></textarea>
                </div>

                <hr class="mb-4">
                <button class="btn btn-primary btn-lg btn-block" type="button" id="btn_submit" onclick="go_submit();">제출하기</button>
            </form>
        </div>
    </div>


    <div class="copy">
            © Copyright 2019, DIO 20주년 파티 기획단
        <ul class="list-inline">
            <li class="list-inline-item"><a href="./index.html">포스터</a></li>
            <li class="list-inline-item"><a href="./invitation.html">초대장</a></li>
            <li class="list-inline-item"><a href="./attendCheck.html">참석현황</a></li>
        </ul>
    </div>
    </div>
</body>
<?php include("./footer.html") ?>
<script>
    console.log("test22");
    function go_submit(){
        console.log("go_submit");
        if (document.submit_form.name.value.length == 0) {
            alert("이름을 입력해주세요");
            submit_form.name.focus();
            return;
        }

        var regNumber = /^[0-9]*$/;
        if(!regNumber.test(document.submit_form.extraPeoples.value)) {
            alert("함께 오시는 인원은 숫자만 입력 가능합니다");
            submit_form.extraPeoples.focus();
            return;
        }
         
        var submit_data = $("form[name=submit_form]").serialize() ;   
        console.log(JSON.stringify(submit_data));
        
        $.ajax({
            type : 'post',
            url : 'attendSubmit.php',
            data : $("form[name=submit_form]").serializeArray(),
            dataType : 'text',
            error : function(request, status, error){
                alert(error);
                console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);

            },
            success : function(data){
                console.log(data);
                console.log("success");
            }
        });
        console.log("ajax end");
    }

</script>